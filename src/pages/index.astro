---
import Default from '../layouts/DefaultLayout.astro';
import Hero from '../components/Hero.tsx';

const trajectory = [
  {
    organization: 'Instituto de Desarrollo Agropecuario (INDAP)',
    role: 'Jefe de Comunicación Corporativa',
    period: '2023 – Actualidad',
    link: 'https://www.indap.gob.cl/',
    image: '/images/exp-indap.png',
    alt: 'INDAP',
  },
  {
    organization: 'Ministerio de Educación',
    role: 'Coordinador de Comunicaciones',
    period: '2021 – 2022',
    link: 'https://www.mineduc.cl/',
    image: '/images/exp-mineduc.png',
    alt: 'Ministerio de Educación',
  },
  {
    organization: 'Subsecretaría de Telecomunicaciones',
    role: 'Asesor Comunicacional',
    period: '2018 – 2020',
    link: 'https://www.subtel.gob.cl/',
    image: '/images/exp-subtel.png',
    alt: 'Subsecretaría de Telecomunicaciones',
  },
  {
    organization: 'Municipalidad de Cerro Navia',
    role: 'Periodista Territorial',
    period: '2016 – 2017',
    link: 'https://www.cerronavia.cl/',
    image: '/images/exp-cerro-navia.png',
    alt: 'Municipalidad de Cerro Navia',
  },
  {
    organization: 'La Tercera',
    role: 'Periodista de Investigación',
    period: '2014 – 2016',
    link: 'https://www.latercera.com/',
    image: '/images/exp-la-tercera.png',
    alt: 'La Tercera',
  },
  {
    organization: 'Publimetro · TVN',
    role: 'Reportero y conductor de cobertura',
    period: '2012 – 2014',
    link: '',
    image: '/images/exp-publimetro.png',
    alt: 'Publimetro y TVN',
  },
];

const projects = [
  {
    id: 'operacion-topografo',
    title: 'Operación Topógrafo',
    category: 'Investigación',
    image: '/images/topografo.jpg',
    alt: 'Operación Topógrafo',
    summary: 'Investigación que reveló espionaje militar a periodistas y denunciantes.',
    details: [
      'Reportaje de investigación que reveló el espionaje de la Dirección de Inteligencia del Ejército a periodistas y funcionarios denunciantes.',
      'La publicación marcó un antes y un después en la discusión sobre transparencia y control civil de las Fuerzas Armadas, con repercusiones judiciales y mediáticas que se mantienen hasta hoy.',
    ],
  },
  {
    id: 'vocerias-y-despliegue',
    title: 'Vocerías y despliegue',
    category: 'Conducción estratégica',
    image: '/images/vocerias.jpg',
    alt: 'Vocerías y despliegue',
    summary: 'Fortalecimiento de vocerías y coherencia comunicacional en terreno.',
    details: [
      'Diseño de lineamientos, preparación de portavoces, acompañamiento en terreno y estandarización de mensajes clave para un despliegue coherente en medios, regiones y redes.',
    ],
  },
  {
    id: 'comunicacion-digital',
    title: 'Comunicación digital',
    category: 'Narrativa y medición',
    image: '/images/digital.jpg',
    alt: 'Comunicación digital',
    summary: 'Estrategia y formatos nativos para alto rendimiento.',
    details: [
      'Reorientación de equipos y parrillas a formatos nativos, workflows editoriales y medición de impacto para mejorar alcance, retención y reputación en plataformas sociales.',
    ],
  },
];

const formatReflectionParagraph = (value: string) =>
  value
    .replace(/^>\s*/, '')
    .replace(/\*\*(.+?)\*\*/g, '$1')
    .replace(/\*(.+?)\*/g, '$1')
    .replace(/`(.+?)`/g, '$1')
    .trim();

const reflectionEntries = await Astro.glob('./reflexiones/*.md');
const reflectionSummaries: Record<string, string> = {
  'la-ley-de-la-variedad-requerida':
    'La ley de la variedad requerida, postulada por Ross Ashby en 1958, es una de las piedras angulares de la cibernética y una lección vigente para afrontar el entorno comunicativo actual. Según el psiquiatra inglés, un sistema solo puede sobrevivir y mantenerse estable si su capacidad de respuestas al menos iguala la complejidad de las perturbaciones que provienen del entorno.',
  'comunicar-sin-miedo':
    'Durante una visita a Rapa Nui tuve la oportunidad de entrevistar a la alcaldesa Elizabeth Arévalo Pakarati. Terminada la conversación, mi reacción fue inmediata: ya quisiera cualquier político o directivo de empresa su capacidad de comunicar, le dije. Todo funcionó perfecto. Su vestimenta, postura, tono y locuacidad —del latín loquax, “el que tiene facilidad de palabra”— demostraban un trabajo constante y dedicado. Lejos de parecer una imagen artificial, solo irradiaba seguridad en sí misma.',
  'autoridades-y-redes-sociales':
    'Pese a lo que muchas autoridades creen, las redes sociales institucionales no son su canal de noticias 24/7 a su disposición. Registrar y publicar cada una de sus actividades públicas no solo distrae a los equipos de comunicaciones de lo realmente importante —gestión de prensa, comunicación interna o creación de contenido de valor—, sino que termina generando más bloqueos que los soñados “likes”.',
};

const reflexiones = reflectionEntries
  .map((entry) => {
    const slugFromUrl = entry.url?.split('/').filter(Boolean).pop();
    const slugFromFile = entry.file.substring(entry.file.lastIndexOf('/') + 1).replace(/\.md$/i, '');
    const slug = slugFromUrl ?? slugFromFile ?? `reflexion-${Math.random().toString(36).slice(2, 8)}`;

    const paragraphs = entry
      .rawContent()
      .split(/\r?\n\r?\n/)
      .map((paragraph) => paragraph.trim())
      .filter(Boolean)
      .map(formatReflectionParagraph);

    const summary = reflectionSummaries[slug] ?? paragraphs[0] ?? '';
    const content = [...paragraphs];

    const rawOrder = entry.frontmatter?.order;
    const order = typeof rawOrder === 'number' ? rawOrder : Number.NEGATIVE_INFINITY;

    return {
      id: slug,
      title: entry.frontmatter?.title ?? slug,
      summary,
      content,
      order,
    };
  })
  .sort((a, b) => b.order - a.order)
  .map(({ order, ...rest }) => rest);

const press = [
  {
    title: 'Operación Topógrafo — Espionaje del Ejército a denunciantes',
    outlet: 'La Tercera',
    link: 'https://www.latercera.com/reportajes/noticia/operacion-topografo-espionaje-del-ejercito-cuatro-denunciantes-irregularidades/777342/',
    image: '/images/topografo.jpg',
    alt: 'Operación Topógrafo — Espionaje del Ejército a denunciantes',
    summary: 'Investigación que reveló el espionaje del Ejército a periodistas y denunciantes.',
  },
  {
    title: 'Ricardo Lagos: “Durante mi gobierno no privaticé nada, al contrario”',
    outlet: 'Publimetro',
    link: 'https://www.publimetro.cl/cl/noticias/2016/11/18/ex-presidente-lagos-durante-mi-gobierno-no-privatice-nada-contrario.html',
    image: '/images/lagos.jpg',
    alt: 'Ricardo Lagos: “Durante mi gobierno no privaticé nada, al contrario”',
    summary: 'Entrevista al ex Presidente Ricardo Lagos sobre su legado económico y político.',
  },
  {
    title: 'Sebastián Piñera: “Me siento orgulloso de lo que he logrado en la vida”',
    outlet: 'Publimetro',
    link: 'https://www.publimetro.cl/cl/noticias/2017/06/19/sebastian-pinera-me-siento-orgulloso-lo-he-logrado-vida.html',
    image: '/images/pinera.jpg',
    alt: 'Sebastián Piñera: “Me siento orgulloso de lo que he logrado en la vida”',
    summary: 'Entrevista centrada en la trayectoria empresarial y política de Sebastián Piñera.',
  },
  {
    title: 'Hernán Larraín: “No somos partidarios de indultar a violadores de DD.HH. ni asesinos en serie”',
    outlet: 'La Tercera',
    link: 'https://www.latercera.com/nacional/noticia/hernan-larrain-ministro-justicia-derechos-humanos-no-somos-partidarios-indultar-violadores-dd-hh-asesinos-serie/111533/',
    image: '/images/larrain.jpg',
    alt: 'Hernán Larraín: “No somos partidarios de indultar a violadores de DD.HH. ni asesinos en serie”',
    summary: 'Entrevista sobre justicia transicional, derechos humanos y políticas del Ministerio de Justicia.',
  },
  {
    title: 'La declaración de ‘Ramiro’ ante Carroza',
    outlet: 'La Tercera',
    link: 'https://www.latercera.com/la-tercera-pm/noticia/la-declaracion-ramiro-carroza-estoy-seguro-estaba-privado-libertad-detencion-preventiva/792779/',
    image: '/images/ramiro.jpg',
    alt: 'La declaración de ‘Ramiro’ ante Carroza',
    summary: 'Cobertura al testimonio de Mauricio Hernández Norambuena (Ramiro) ante el ministro Carroza.',
  },
  {
    title: "El Papa en La Araucanía: 'Mari Mari, peñi, lamngen'",
    outlet: 'La Tercera',
    link: 'https://www.latercera.com/noticia/papa-la-araucania-mari-mari/',
    image: '/images/papa.jpg',
    alt: "El Papa en La Araucanía: 'Mari Mari, peñi, lamngen'",
    summary: 'Cobertura especial de la visita del Papa Francisco a La Araucanía.',
  },
  {
    title: 'Llaitul: líderes mapuches llaman a la resistencia en funeral de Catrillanca',
    outlet: 'La Tercera',
    link: 'https://www.latercera.com/nacional/noticia/llaitul-lideres-mapuches-llaman-resistencia-funeral-catrillanca/406714/',
    image: '/images/catrillanca.jpg',
    alt: 'Llaitul llama a la resistencia en funeral de Camilo Catrillanca',
    summary: 'Cobertura sobre el funeral de Camilo Catrillanca.',
  },
  {
    title: 'Habla el juez de Rancagua Marcelo Vásquez',
    outlet: 'La Tercera',
    link: 'https://www.latercera.com/reportajes/noticia/habla-el-juez-de-rancagua-marcelo-vasquez-siento-decepcion-de-haber-impartido-un-tipo-de-justicia-que-hoy-se-me-niega/747167/',
    image: '/images/vasquez.jpg',
    alt: 'Juez Marcelo Vásquez: "Siento decepción de haber impartido un tipo de justicia que hoy se me niega"',
    summary: 'Visión del juez Marcelo Vásquez sobre la crisis judicial en Rancagua.',
  },
  {
    title: 'Eduardo Frei: “He sido víctima de un gran fraude”',
    outlet: 'La Tercera',
    link: 'https://www.latercera.com/politica/noticia/eduardo-frei-he-victima-gran-fraude/823635/',
    image: '/images/frei.jpg',
    alt: 'Eduardo Frei sobre el fraude que lo afectó',
    summary: 'Crónica sobre conferencia de prensa de Eduardo Frei sobre la estafa que impactó a su familia.',
  },
  {
    title: 'La Parinacota: balas y abandono',
    outlet: 'La Tercera',
    link: 'https://www.latercera.com/nacional/noticia/la-parinacota-balas-abandono/614633/',
    image: '/images/parinacota.jpg',
    alt: 'Reportaje La Parinacota: entre las balas y el abandono',
    summary: 'Reportaje sobre el abandono y la violencia en la población ubicada en la comuna de Quilicura.',
  },
  {
    title: 'Los múltiples contratos del médico de la Presidenta Bachelet',
    outlet: 'Publimetro',
    link: 'https://www.publimetro.cl/cl/noticias/2016/12/13/multiples-contratos-medico-presidenta-bachelet.html',
    image: '/images/puccio.jpg',
    alt: 'Investigación sobre los contratos del médico de Bachelet',
    summary: 'Investigación periodística sobre los contratos del médico de la Presidenta Bachelet.',
  },
];
---
<Default title="Inicio">
  <Hero client:load />

  <section class="max-w-4xl mx-auto px-6 py-16">
    <blockquote class="relative overflow-hidden rounded-[2.5rem] border border-black/10 bg-gradient-to-br from-[#0E1B26] via-[#122332] to-[#0B161F] p-12 text-lg text-white shadow-[0_32px_64px_rgba(0,0,0,0.45)]">
      <span class="pointer-events-none absolute -top-24 -right-16 h-64 w-64 rounded-full bg-accent-alt/30 blur-3xl" aria-hidden="true" />
      <p class="text-3xl font-heading leading-snug tracking-[-0.02em]">
        “Ningún actor puede controlar el entorno sin igualarlo en complejidad; y si no puede igualarlo, debe aprender a domesticarlo.”
      </p>
      <span class="mt-6 block text-sm font-semibold uppercase tracking-[0.3em] text-accent-alt">Ross Ashby</span>
    </blockquote>
  </section>

  <section id="experiencia" class="max-w-6xl mx-auto px-6 py-16">
    <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
      <div class="space-y-3">
        <p class="text-xs uppercase tracking-[0.35em] text-text-dim">Trayectoria</p>
        <h2 class="text-3xl font-heading tracking-[-0.02em] text-text-light">Roles clave al servicio de la comunicación pública</h2>
      </div>
    </div>
    <div class="mt-10 grid gap-6 md:grid-cols-2">
      {trajectory.map(({ organization, role, period, link, image, alt }) => (
        <div class="group flex h-full flex-col gap-6 rounded-[2rem] border border-black/5 bg-gradient-to-br from-[#F8EFDD] via-[#F2E6D5] to-[#E9D7BE] p-8 shadow-[0_24px_48px_rgba(20,20,20,0.12)] transition hover:-translate-y-2 hover:shadow-[0_32px_64px_rgba(20,20,20,0.18)]">
          <div class="flex items-start gap-5">
            <div class="flex h-16 w-16 items-center justify-center rounded-2xl border border-black/10 bg-white shadow-[0_12px_24px_rgba(15,15,15,0.08)]">
              <img src={image} alt={alt} class="max-h-10 w-auto" loading="lazy" />
            </div>
            <div class="space-y-2">
              <p class="text-[0.65rem] font-semibold uppercase tracking-[0.35em] text-text-dim">{period}</p>
              <h3 class="text-xl font-heading tracking-[-0.015em] text-text-light">{role}</h3>
              <p class="text-sm text-text-dim">{organization}</p>
            </div>
          </div>
          {link && (
            <div class="flex justify-end">
              <a
                href={link}
                target="_blank"
                rel="noopener"
                class="btn gap-2"
              >
                Ver organización <span>→</span>
              </a>
            </div>
          )}
        </div>
      ))}
    </div>
  </section>

  <section id="proyectos" class="max-w-6xl mx-auto px-6 py-16">
    <h2 class="text-3xl font-heading mb-6">Proyectos</h2>
    <p class="text-text-dim max-w-3xl mb-10">Una selección de casos con impacto, contados en tarjetas con profundidad.</p>
    <div class="grid gap-10 md:grid-cols-3">
      {projects.map(({ id, title, category, image, alt, summary, details }) => (
        <div class="contents">
          <article class="group relative flex h-full flex-col gap-6 rounded-[2.5rem] bg-[#E8E1CF] p-8 shadow-[0_30px_60px_rgba(0,0,0,0.12)] transition hover:-translate-y-2 hover:shadow-[0_36px_72px_rgba(0,0,0,0.18)]">
            <div class="relative overflow-hidden rounded-3xl">
              <img src={image} alt={alt} class="aspect-[4/3] w-full object-cover transition duration-500 group-hover:scale-[1.04]" loading="lazy" />
            </div>
            <div class="space-y-4">
              <p class="text-xs uppercase tracking-[0.3em] text-text-dim">{category}</p>
              <h3 class="text-2xl font-semibold leading-tight text-text-light">
                <span class="title-highlight-hover">{title}</span>
              </h3>
              <p class="text-sm text-text-dim hover-highlight-base">{summary}</p>
              <div class="flex justify-end">
                <button
                  type="button"
                  class="btn"
                  data-modal={`modal-proyecto-${id}`}
                >
                  Ver caso
                </button>
              </div>
            </div>
          </article>
          <dialog id={`modal-proyecto-${id}`} class="app-modal">
            <form method="dialog" class="flex justify-end">
              <button class="btn">
                Cerrar
              </button>
            </form>
            <div class="space-y-4">
              <p class="text-xs uppercase tracking-[0.3em] text-text-dim">{category}</p>
              <h3 class="text-2xl font-semibold text-text-light">{title}</h3>
              {details.map((paragraph) => (
                <p class="text-sm leading-relaxed text-text-dim">{paragraph}</p>
              ))}
            </div>
          </dialog>
        </div>
      ))}
    </div>
  </section>

  <section id="reflexiones" class="max-w-6xl mx-auto px-6 py-16">
    <h2 class="text-3xl font-heading mb-6">Opinión</h2>
    <div class="grid gap-10 md:grid-cols-3">
      {reflexiones.map(({ id, title, summary, content }) => (
        <div class="contents">
          <article class="reflection-card group relative flex h-full flex-col gap-5 rounded-[2rem] border border-black/10 bg-[#F5EDDD] p-8 shadow-[0_18px_36px_rgba(0,0,0,0.12)] transition hover:-translate-y-2">
            <span class="reflection-line" aria-hidden="true" />
            <h3 class="text-2xl font-semibold text-text-light">
              <span class="title-highlight-hover">{title}</span>
            </h3>
            <div class="flex-1 space-y-3 text-sm text-text-dim">
              <p class="reflection-summary">{summary}</p>
            </div>
            <button type="button" class="btn reflection-toggle mt-auto self-start" data-modal={`reflection-${id}`}>
              Leer completa
            </button>
          </article>
          <dialog id={`reflection-${id}`} class="app-modal reflection-modal">
            <form method="dialog" class="flex justify-end">
              <button class="btn">Cerrar</button>
            </form>
            <div class="reflection-modal-content">
              <span class="reflection-modal-ornament" aria-hidden="true" />
              <div class="space-y-4">
                <h3 class="text-2xl font-semibold text-text-light">{title}</h3>
                <p class="text-xs uppercase tracking-[0.3em] text-text-dim">Por S. Vedoya</p>
                {content.map((paragraph) => (
                  <p class="text-sm leading-relaxed text-text-dim">{paragraph}</p>
                ))}
              </div>
            </div>
          </dialog>
        </div>
      ))}
    </div>
  </section>

  <section id="prensa" class="max-w-6xl mx-auto px-6 py-16">
    <h2 class="text-3xl font-heading mb-6">Prensa</h2>
    <div class="grid gap-8 lg:grid-cols-3">
      {press.map(({ title, outlet, link, image, alt, summary }, index) => (
        <article class={`press-card flex h-full flex-col overflow-hidden rounded-[2rem] border border-black/10 bg-bg-card shadow-[0_28px_56px_rgba(0,0,0,0.18)] transition hover:-translate-y-2 hover:shadow-[0_34px_64px_rgba(0,0,0,0.24)] ${index > 2 ? 'hidden' : ''}`}>
          <div class="relative">
            <img src={image} alt={alt} class="h-48 w-full object-cover" loading="lazy" />
            <span class="absolute bottom-4 right-4 rounded-full bg-black/80 px-4 py-1 text-xs uppercase tracking-[0.4em] text-accent-alt">{outlet}</span>
          </div>
          <div class="flex flex-1 flex-col gap-4 p-8">
            <h3 class="text-xl font-semibold text-text-light">
              <span class="title-highlight-hover">{title}</span>
            </h3>
            <p class="text-sm text-text-dim">{summary}</p>
            <div class="mt-auto flex justify-end">
              <a
                href={link}
                target="_blank"
                rel="noopener"
                class="btn"
              >
                Nota completa
              </a>
            </div>
          </div>
        </article>
      ))}
    </div>
    <div class="mt-8 flex justify-center">
      <button id="press-toggle" class="btn">Ver más</button>
    </div>
  </section>

  <section id="contacto" class="max-w-3xl mx-auto px-6 py-16">
    <div class="rounded-2xl border border-black/5 bg-bg-card px-8 py-12 text-center shadow-[0_20px_40px_rgba(20,20,20,0.08)]">
      <h2 class="text-3xl font-heading mb-4">¿Conversamos?</h2>
      <p class="text-text-dim">Escríbeme y revisa mi CV.</p>
      <div class="mt-8 flex flex-col items-center justify-center gap-4 sm:flex-row">
        <a href="mailto:seba.vedoya@gmail.com" class="btn normal-case tracking-[0.1em]">
          seba.vedoya@gmail.com
        </a>
        <a href="/files/CV.pdf" class="btn">
          Descargar CV
        </a>
        <a
          href="https://www.linkedin.com/in/sebastianvedoyam/"
          target="_blank"
          rel="noopener"
          class="btn"
        >
          LinkedIn
        </a>
      </div>
    </div>
  </section>

  <script is:inline>
    const modalTriggers = document.querySelectorAll('[data-modal]');
    const modals = document.querySelectorAll('.app-modal');

    modalTriggers.forEach((trigger) => {
      trigger.addEventListener('click', () => {
        const id = trigger.getAttribute('data-modal');
        const dialog = id ? document.getElementById(id) : null;
        if (dialog instanceof HTMLDialogElement && typeof dialog.showModal === 'function') {
          dialog.showModal();
        }
      });
    });

    modals.forEach((dialog) => {
      dialog.addEventListener('click', (event) => {
        const rect = dialog.getBoundingClientRect();
        const outside =
          event.clientX < rect.left ||
          event.clientX > rect.right ||
          event.clientY < rect.top ||
          event.clientY > rect.bottom;

        if (outside) {
          dialog.close();
        }
      });

      dialog.addEventListener('cancel', (event) => {
        event.preventDefault();
        dialog.close();
      });
    });

    const pressToggle = document.getElementById('press-toggle');
    const pressCards = document.querySelectorAll('.press-card');
    let pressExpanded = false;

    if (pressToggle) {
      pressToggle.addEventListener('click', () => {
        pressExpanded = !pressExpanded;
        pressCards.forEach((card, index) => {
          if (index > 2) {
            card.classList.toggle('hidden', !pressExpanded);
          }
        });
        pressToggle.textContent = pressExpanded ? 'Ver menos' : 'Ver más';
      });
    }

    const reflectionToggles = document.querySelectorAll('.reflection-toggle');
    reflectionToggles.forEach((toggle) => {
      toggle.addEventListener('click', () => {
        const card = toggle.closest('.reflection-card');
        const details = card?.querySelector('.reflection-details');
        if (!card || !details) {
          return;
        }

        const isHidden = details.classList.toggle('hidden');
        toggle.textContent = isHidden ? 'Ver más' : 'Ver menos';
      });
    });
  </script>
</Default>
